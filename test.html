<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Scan Code-Barres</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://unpkg.com/html5-qrcode"
      type="text/javascript"
    ></script>
    <style>
      @font-face {
        font-family: "earth";
        src: url("/fonts/EARTH.TTF") format("truetype");
        font-weight: normal;
        font-style: normal;
      }
 
      header {
        display: flex;
        height: 100px;
        align-items: center;
        justify-content: flex-start;
        background-color: #002236;
        padding: 40px 40px;
        border-bottom: 2px solid #444;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        position: relative;
      }
 
      header h1 {
        margin-top: 2rem;
        font-family: "earth";
        color: #bfbfbf;
        font-size: 2.5rem;
        line-height: 3rem;
        position: absolute;
        left: 0;
        right: 0;
        text-align: center;
        pointer-events: none;
        text-transform: uppercase;
 
        /* üñ§ Ombre simple basse et contour noir */
        text-shadow: 1px 1px 0 #000, 2px 2px 0 #000,
          3px 3px 3px rgba(0, 0, 0, 0.6);
      }
 
      #reader {
        width: 300px;
        margin: auto;
        border-radius: 20px;
        overflow: hidden;
        border: 5px solid #64a03b;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
        background-color: #001a28;
      }
 
      form {
        display: flex;
        flex-direction: column;
        align-items: flex-end; /* aligne le tout √† gauche */
        gap: 2rem;
        margin: 100px auto;
        width: fit-content;
        color: #fff;
        text-shadow: #000 2px 2px;
      }
 
      .form-row {
        display: grid;
        flex-direction: row;
        align-items: center;
        gap: 1rem;
        padding: 2rem;
      }
 
      label {
        font-family: "Quicksand", sans-serif;
        color: #bfbfbf;
        font-size: 3rem;
        text-align: Left; /* texte du label align√© √† droite */
        /* üñ§ Ombre simple basse et contour noir */
        text-shadow: 1px 1px 0 #000, 2px 2px 0 #000,
          3px 3px 3px rgba(0, 0, 0, 0.6);
      }
 
      input[type="text"] {
        font-family: "Quicksand", sans-serif;
        padding: 5px 10px;
        font-size: 3rem;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
 
      .newbackground {
        z-index: -3;
        top: 0;
        left: 0;
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgb(0, 68, 103);
        background: radial-gradient(
          circle,
          rgba(0, 68, 103, 1) 3%,
          rgba(0, 59, 89, 1) 22%,
          rgba(0, 34, 54, 1) 65%
        );
      }
    </style>
  </head>
  <header>
    <h1>Fermeture S√©quence Mati√®re</h1>
  </header>
  <body>
    <form id="formulaire" action="">
      <div class="form-row">
        <label for="EmployerID">Num√©ro Employ√© :</label>
        <input type="text" name="EmployerID" />
      </div>
      <div class="form-row">
        <label for="WorkOrder">WO Number :</label>
        <input type="text" name="WorkOrder" />
      </div>
      <div class="form-row">
        <label for="Sequence">S√©quence :</label>
        <input type="text" name="Sequence" />
      </div>
    </form>
 
    <div id="reader"></div>
 
    <script>
      let currentInput = null;
      let scanner = null;
 
      function startScanner(targetInput) {
        if (scanner) return; // ne pas red√©marrer si d√©j√† actif
 
        currentInput = targetInput;
 
        scanner = new Html5Qrcode("reader");
 
        scanner
          .start(
            { facingMode: "environment" },
            { fps: 10, qrbox: 250 },
            (decodedText) => {
              console.log("‚úÖ Scan : " + decodedText);
 
              if (currentInput) {
                currentInput.value = decodedText;
                currentInput.blur(); // retire le focus
              }
 
              scanner.stop().then(() => {
                scanner.clear();
                scanner = null;
              });
            }
          )
          .catch((err) => {
            console.error("‚ùå Erreur scanner : ", err);
            scanner = null;
          });
      }
 
      // Attache un √©v√©nement sur tous les <input>
      window.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll("input[type='text']").forEach((input) => {
          input.addEventListener("focus", () => startScanner(input));
        });
      });
    </script>
 
    <div class="newbackground"></div>
  </body>
</html>
